     1                                  extern PROCEDURAL
     2                                  extern OBJECTORIENTED
     3                                  extern FUNCTIONAL
     4                                  
     5                                  ;
     6                                  ;;double YearsDivideLettersFunctional(void *func) {
     7                                  ;;    int years = *((int *) (func + doubleSize));
     8                                  ;;    return (double) years / (double) 10;
     9                                  ;;}
    10                                  
    11                                  
    12                                  global YearsDivideLettersFunctional
    13                                  YearsDivideLettersFunctional:
    14                                  section .text
    15 00000000 55                      push rbp
    16 00000001 4889E5                  mov rbp, rsp
    17                                  
    18                                      ; В rdi адрес прямоугольника
    19 00000004 8B4708                      mov eax, [rdi+8]
    20 00000007 BA00000000                  mov edx, 0
    21 0000000C B90A000000                  mov ecx, 10
    22 00000011 F7F1                        div ecx
    23 00000013 F20F2AC0                    cvtsi2sd    xmm0, eax
    24                                  
    25 00000017 C9                      leave
    26 00000018 C3                      ret
    27                                  
    28                                  global YearsDivideLettersObjectOriented
    29                                  YearsDivideLettersObjectOriented:
    30                                  section .text
    31 00000019 55                      push rbp
    32 0000001A 4889E5                  mov rbp, rsp
    33                                  
    34                                      ; В rdi адрес прямоугольника
    35 0000001D 8B4708                      mov eax, [rdi+8]
    36 00000020 BA00000000                  mov edx, 0
    37 00000025 B90E000000                  mov ecx, 14
    38 0000002A F7F1                        div ecx
    39 0000002C F20F2AC0                    cvtsi2sd    xmm0, eax
    40                                  
    41 00000030 C9                      leave
    42 00000031 C3                      ret
    43                                  
    44                                  global YearsDivideLettersProcedural
    45                                  YearsDivideLettersProcedural:
    46                                  section .text
    47 00000032 55                      push rbp
    48 00000033 4889E5                  mov rbp, rsp
    49                                  
    50                                      ; В rdi адрес прямоугольника
    51 00000036 8B4708                      mov eax, [rdi+8]
    52 00000039 BA00000000                  mov edx, 0
    53 0000003E B90E000000                  mov ecx, 14
    54 00000043 F7F1                        div ecx
    55 00000045 F20F2AC0                    cvtsi2sd    xmm0, eax
    56                                  
    57 00000049 C9                      leave
    58 0000004A C3                      ret
    59                                  
    60                                  ; int BinarySearch(void *c, void *item, int low, int high)
    61                                  ; {
    62                                  ;     if (high <= low)
    63                                  ;     {
    64                                  ;         return (YearsDivideLetters(item) < YearsDivideLetters(c + low * programminglanguageSize)) ? (low + 1) : low;
    65                                  ;     }
    66                                  ;     int mid = (low + high) / 2;
    67                                  ;     if (YearsDivideLetters(item) == YearsDivideLetters(c + programminglanguageSize * mid))
    68                                  ;     {
    69                                  ;         return mid + 1;
    70                                  ;     }
    71                                  ;     if (YearsDivideLetters(item) < YearsDivideLetters(c + programminglanguageSize * mid))
    72                                  ;     {
    73                                  ;         return BinarySearch(c, item, mid + 1, high);
    74                                  ;     }
    75                                  ;     return BinarySearch(c, item, low, mid - 1);
    76                                  ; }
    77                                  
    78                                  ; global BinarySearch
    79                                  ; BinarySearch:
    80                                  ; section .text
    81                                  ; push rbp
    82                                  ; mov rbp, rsp
    83                                  
    84                                  ;     ; В rdi адрес прямоугольника
    85                                  ;     mov eax, [rdi+8]
    86                                  ;     mov edx, 0
    87                                  ;     mov ecx, 14
    88                                  ;     div ecx
    89                                  ;     cvtsi2sd    xmm0, eax
    90                                  
    91                                  ; leave
    92                                  ; ret
    93                                  
    94                                  ; double YearsDivideLetters(void *s)
    95                                  ; {
    96                                  ;     int k = *((int *)s);
    97                                  ;     if (k == FUNCTIONAL)
    98                                  ;     {
    99                                  ;         return YearsDivideLettersFunctional(s + intSize);
   100                                  ;     }
   101                                  ;     else if (k == OBJECTORIENTED)
   102                                  ;     {
   103                                  ;         return YearsDivideLettersObjectOriented(s + intSize);
   104                                  ;     }
   105                                  ;     else if (k == PROCEDURAL)
   106                                  ;     {
   107                                  ;         return YearsDivideLettersProcedural(s + intSize);
   108                                  ;     }
   109                                  ;     return -1;
   110                                  ; }
   111                                  
   112                                  global YearsDivideLetters
   113                                  YearsDivideLetters:
   114                                  section .text
   115 0000004B 55                      push rbp
   116 0000004C 4889E5                  mov rbp, rsp
   117                                  
   118                                      ; В rdi адрес фигуры
   119 0000004F 8B07                        mov eax, [rdi]
   120 00000051 3B0425[00000000]            cmp eax, [FUNCTIONAL]
   121 00000058 741A                        je .functionalDivide
   122 0000005A 3B0425[00000000]            cmp eax, [OBJECTORIENTED]
   123 00000061 741C                        je .objectDivide
   124 00000063 3B0425[00000000]            cmp eax, [PROCEDURAL]
   125 0000006A 741E                        je .procedurallDivide
   126 0000006C 31C0                        xor eax, eax
   127 0000006E F20F2AC0                    cvtsi2sd    xmm0, eax
   128 00000072 EB1F                        jmp     .return
   129                                  .functionalDivide:
   130 00000074 4883C704                    add     rdi, 4
   131 00000078 E883FFFFFF                  call    YearsDivideLettersFunctional
   132 0000007D EB14                        jmp     .return
   133                                  .objectDivide:
   134 0000007F 4883C704                    add     rdi, 4
   135 00000083 E891FFFFFF                  call    YearsDivideLettersObjectOriented
   136 00000088 EB09                        jmp     .return
   137                                  .procedurallDivide:
   138 0000008A 4883C704                    add     rdi, 4
   139 0000008E E89FFFFFFF                  call    YearsDivideLettersProcedural
   140                                  .return:
   141 00000093 C9                      leave
   142 00000094 C3                      ret
